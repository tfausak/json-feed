os: linux
dist: bionic
language: generic
addons:
  apt:
    packages:
      - libgmp-dev
env:
  global:
    - HACKAGE_USERNAME=fozworth
    # HACKAGE_PASSWORD
    - secure: tda6hl77RB3l8WZQtPGcT0v0r4ChlfFLqjLqzrJOUHsWawQwgauWckvZh9mkIK4ye610FZkrB5S8asEMtN7Ql6SK2FuXq/4t59VMQTjEiu/OKNJjhgcuEXRdkmA/hljVOvh2NiTqXgf1ap0J3rcle7R7I3c2F9XLZQHArX2R9qaEDjyXG6dcFy6c93q5Vi6xmHhVXX0sRKVyrDCR5NANdT1XDOXc3Bis8q//uXeJ/jnMztGddnZUh5+R/FTnd7hA9vCQFRy5mS0zbjSiBCg+UtKlxJ9KqN2Pqilheq5hqIuW5JOjxVciviPRdXN9dOLMcANZZtb64QVcPhcK5Qm8N97MSiYqspGZ3ql5O1SUJ5ZzQjjcZPVbYtaSAf35HvoFKdCGe5hRxDZi1NkgQKkwr86qoLdALRoz+Dv7ZMpEudnUGtZze0O56T/e5XV7WMNMU7EA4RQkQHYADIT5n8iVeiAn8PBtg0fEmsObrhlH2I7cVLVVCfuWQIUEbhEqAhY9XToUJhbEXB3NylTDxYXT8W5NhmkjiFLBYoM8su/gLW/PN5vLGcctXW/jIIBJfmny2+3Q1JoT2iEj3HQmRMYSryRByGG4Ef36pKUBQ3g1bvmo7vo3INeIPsqxhFtPht0Gre6EqtT7SEIoVOxFxpTLV6imxrsmhRdEAqJy6wVpavE=

cache:
  directories:
    - $HOME/.local/bin
    - $HOME/.stack

before_install:
  - |
    if ! test -f "$HOME/.local/bin/stack"
    then
      VERSION=2.3.1
      URL="https://github.com/commercialhaskell/stack/releases/download/v$VERSION/stack-$VERSION-linux-x86_64.tar.gz"
      curl --location --output stack.tar.gz "$URL"
      gunzip stack.tar.gz
      tar --extract --file stack.tar --strip-components 1
      mkdir --parents "$HOME/.local/bin"
      mv stack "$HOME/.local/bin"
      rm stack.tar
    fi
  - stack --version

install:
  - stack setup
  - stack build --only-dependencies --test

script:
  - stack build --no-run-tests --pedantic --test
  - stack build --test
  - stack sdist

deploy:
  provider: script
  on:
    tags: true
  skip_cleanup: true
  script: yes | stack upload .
